<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Distribution Calculator</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <!-- Inter font for shadcn/ui look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* shadcn/ui-like components */
        .input {
            @apply block w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm 
            ring-offset-white transition-colors placeholder:text-zinc-500 
            focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 
            focus-visible:ring-offset-2;
        }
        
        .btn {
            @apply inline-flex items-center justify-center rounded-md text-sm font-medium 
            transition-colors focus-visible:outline-none focus-visible:ring-2 
            focus-visible:ring-zinc-950 focus-visible:ring-offset-2 
            disabled:pointer-events-none disabled:opacity-50;
        }
        
        .btn-outline {
            @apply border border-zinc-200 bg-white hover:bg-zinc-100 hover:text-zinc-900 
            h-10 px-4 py-2;
        }
        
        .btn-ghost {
            @apply hover:bg-zinc-100 hover:text-zinc-900;
        }
        
        .card {
            @apply rounded-lg border border-zinc-200 bg-white text-zinc-950 shadow-sm;
        }

        .icon-button {
            @apply h-8 w-8 p-0 rounded-md flex items-center justify-center;
        }

        .tax-amount-display {
            @apply bg-zinc-100 p-2 rounded-md text-right font-medium text-zinc-900;
        }

        .validation-success {
            @apply bg-green-50 text-green-800 border border-green-200;
        }

        .validation-error {
            @apply bg-red-50 text-red-800 border border-red-200;
        }

        .header-cell {
            @apply font-medium text-sm text-zinc-500;
        }

        .numeric-cell {
            @apply text-right font-medium text-zinc-900;
        }

        .total-row {
            @apply text-sm text-zinc-600;
        }

        .total-amount {
            @apply font-medium text-zinc-900;
        }
    </style>
</head>
<body class="bg-zinc-50 min-h-screen p-4">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Trash icon component
        const TrashIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" 
                stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
            </svg>
        );

        // Plus icon component
        const PlusIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" 
                stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 5v14m-7-7h14"/>
            </svg>
        );

        const SalesTaxCalculator = () => {
            const [total, setTotal] = useState('');
            const [subtotal, setSubtotal] = useState('');
            const [categories, setCategories] = useState([
                { id: 1, name: '', amount: '', taxPortion: '0.00', total: '0.00' }
            ]);

            useEffect(() => {
                updateCategoryTaxes();
            }, [total, subtotal]);

            const updateCategoryTaxes = () => {
                if (!total || !subtotal) {
                    setCategories(prevCategories => 
                        prevCategories.map(cat => ({
                            ...cat,
                            taxPortion: '0.00',
                            total: cat.amount ? parseFloat(cat.amount).toFixed(2) : '0.00'
                        }))
                    );
                    return;
                }

                const totalAmount = parseFloat(total);
                const subtotalAmount = parseFloat(subtotal);
                const taxAmount = totalAmount - subtotalAmount;

                setCategories(prevCategories => 
                    prevCategories.map(cat => {
                        if (!cat.amount) return { ...cat, taxPortion: '0.00', total: '0.00' };
                        
                        const amount = parseFloat(cat.amount);
                        const proportion = amount / subtotalAmount;
                        const taxPortion = (proportion * taxAmount).toFixed(2);
                        const categoryTotal = (amount + parseFloat(taxPortion)).toFixed(2);
                        
                        return {
                            ...cat,
                            taxPortion,
                            total: categoryTotal
                        };
                    })
                );
            };

            const addCategory = () => {
                const newId = Math.max(...categories.map(cat => cat.id), 0) + 1;
                setCategories(prev => [...prev, {
                    id: newId,
                    name: '',
                    amount: '',
                    taxPortion: '0.00',
                    total: '0.00'
                }]);
            };

            const removeCategory = (id) => {
                if (categories.length === 1) return;
                setCategories(prev => prev.filter(cat => cat.id !== id));
            };

            const handleCategoryChange = (id, field, value) => {
                setCategories(prev => 
                    prev.map(category => {
                        if (category.id === id) {
                            return { ...category, [field]: value };
                        }
                        return category;
                    })
                );
            };

            const validateAmounts = () => {
                if (!subtotal) return { isValid: true, difference: 0 };
                
                const totalAmount = categories.reduce((sum, cat) => 
                    sum + (parseFloat(cat.amount) || 0), 0
                );
                
                return {
                    isValid: Math.abs(totalAmount - parseFloat(subtotal)) < 0.01,
                    difference: (totalAmount - parseFloat(subtotal)).toFixed(2)
                };
            };

            const totalPreTaxAmount = categories.reduce((sum, cat) => 
                sum + (parseFloat(cat.amount) || 0), 0
            ).toFixed(2);

            const totalTaxAllocated = categories.reduce((sum, cat) => 
                sum + (parseFloat(cat.taxPortion) || 0), 0
            ).toFixed(2);

            const totalAmountWithTax = categories.reduce((sum, cat) => 
                sum + (parseFloat(cat.total) || 0), 0
            ).toFixed(2);

            return (
                <div className="max-w-4xl mx-auto">
                    <div className="card">
                        <div className="p-6">
                            <h2 className="text-2xl font-semibold text-zinc-900 mb-6">Tax Distribution Calculator</h2>
                            
                            <div className="space-y-6">
                                {/* Main inputs */}
                                <div className="grid grid-cols-3 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1.5 text-zinc-900">Total (with tax)</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            min="0"
                                            value={total}
                                            onChange={(e) => setTotal(e.target.value)}
                                            placeholder="Enter total amount"
                                            className="input"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1.5 text-zinc-900">Subtotal</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            min="0"
                                            value={subtotal}
                                            onChange={(e) => setSubtotal(e.target.value)}
                                            placeholder="Enter subtotal"
                                            className="input"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1.5 text-zinc-900">Tax Amount</label>
                                        <div className="tax-amount-display">
                                            ${total && subtotal ? (parseFloat(total) - parseFloat(subtotal)).toFixed(2) : '0.00'}
                                        </div>
                                    </div>
                                </div>

                                {/* Categories */}
                                <div className="space-y-4">
                                    <div className="grid grid-cols-4 gap-4">
                                        <div className="header-cell">Category</div>
                                        <div className="header-cell">Amount (pre-tax)</div>
                                        <div className="header-cell">Tax Portion</div>
                                        <div className="header-cell">Total</div>
                                    </div>
                                    
                                    {categories.map((category) => (
                                        <div key={category.id} className="grid grid-cols-4 gap-4 items-center">
                                            <input
                                                value={category.name}
                                                onChange={(e) => handleCategoryChange(category.id, 'name', e.target.value)}
                                                placeholder="Category name"
                                                className="input"
                                            />
                                            <input
                                                type="number"
                                                step="0.01"
                                                min="0"
                                                value={category.amount}
                                                onChange={(e) => handleCategoryChange(category.id, 'amount', e.target.value)}
                                                placeholder="0.00"
                                                className={`input ${subtotal && !validateAmounts().isValid ? 'border-red-500 ring-red-500' : ''}`}
                                            />
                                            <div className="numeric-cell">${category.taxPortion}</div>
                                            <div className="flex items-center justify-between">
                                                <span className="numeric-cell">${category.total}</span>
                                                <button 
                                                    onClick={() => removeCategory(category.id)}
                                                    className="btn btn-ghost icon-button"
                                                    title="Remove category"
                                                >
                                                    <TrashIcon />
                                                </button>
                                            </div>
                                        </div>
                                    ))}

                                    <button onClick={addCategory} className="btn btn-outline w-full">
                                        <PlusIcon />
                                        <span className="ml-2">Add Category</span>
                                    </button>
                                </div>

                                {/* Validation Message */}
                                {subtotal && (
                                    <div className={`p-4 rounded-lg ${validateAmounts().isValid ? 'validation-success' : 'validation-error'}`}>
                                        <div className="text-sm">
                                            {validateAmounts().isValid ? (
                                                'Category amounts match subtotal ✓'
                                            ) : (
                                                <>
                                                    Category amounts {parseFloat(validateAmounts().difference) > 0 ? 'exceed' : 'fall short of'} subtotal by: $
                                                    {Math.abs(parseFloat(validateAmounts().difference)).toFixed(2)}
                                                </>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {/* Totals */}
                                <div className="space-y-2 pt-4 border-t border-zinc-200">
                                    <div className="grid grid-cols-2 total-row">
                                        <span>Total Pre-Tax Amount:</span>
                                        <span className={`text-right ${subtotal && !validateAmounts().isValid ? 'text-red-600' : 'total-amount'}`}>
                                            ${totalPreTaxAmount}
                                        </span>
                                    </div>
                                    <div className="grid grid-cols-2 total-row">
                                        <span>Total Tax Allocated:</span>
                                        <span className="text-right total-amount">${totalTaxAllocated}</span>
                                    </div>
                                    <div className="grid grid-cols-2 total-row">
                                        <span>Total Amount (with tax):</span>
                                        <span className="text-right total-amount">${totalAmountWithTax}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="mt-4 text-center text-sm text-zinc-500">
                        Tax Distribution Calculator • No data is stored • Calculations are performed locally
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SalesTaxCalculator />);
    </script>
</body>
</html>
